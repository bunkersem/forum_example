"use strict";function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function average(e){return e.reduce(function(e,t){return e+t},0)/(e.length||1)}function propToArr(e){return Object.keys(e||[]).map(function(t){return e[t]._key=t,e[t]})}function escapeHtml(e){return String(e).replace(/[&<>"'`=\/]/g,function(e){return entityMap[e]})}function validator(e,t){return{result:e,msg:t}}function checkValid(e){var t=Array.prototype.slice.call(arguments,0).filter(function(e){return!0!==e.result}).map(function(e){return e.msg}).join("\n");return 0===t.length||t}function App(){}function setConditional(e,t){t?$(document.documentElement).addClass(e):$(document.documentElement).removeClass(e)}function onAuthStateLogin(e){$(".accountprofilecomponent").each(function(t,n){var o=$(n);o.hasClass("ready")||(populateProfile(e,n),o.on("click","button.verifymailbtn",function(t){$(t.target).button("loading"),e.sendEmailVerification().then(function(){setTimeout(function(){$(t.target).button("reset"),setTimeout(function(){$(t.target).addClass("disabled"),$(t.target).text("Email Sent (please check your email)")},0)},200),console.log(t.target),console.log("email sent")},function(e){setTimeout(function(){$(t.target).button("reset"),setTimeout(function(){$(t.target).removeClass("btn-primary"),$(t.target).addClass("btn-danger"),$(t.target).text("Unable to send email"),$(t.target).addClass("disabled")},0)},200),console.log("an error happened")})}),o.addClass("ready"))})}function populateProfile(e,t){console.log(t);var n=$(t).find(".profile-props");if(e.photoURL){var o=$('<img width="200px" class="img-rounded profile-pic" alt="Profile Picture">');o.attr("src",e.photoURL),n.append(o)}if(e.displayName){var a=$('<p class="displayname lead"></p>');a.text("User Name: "+e.displayName||"").addClass("displayname"),n.append(a)}if(e.email){var r=$('<p class="email"></p>');r.text("Email: "+e.email||""),n.append(r)}var i=$('<div>Email Verified: &nbsp;<span class="glyphicon glyphicon-'+(e.emailVerified?'ok">':'remove"></span><p></p><button class="btn btn-sm btn-primary verifymailbtn"data-loading-text="<i class=\'fa fa-circle-o-notch fa-spin\'></i> Sending Email" href="signup">Verify Email</button>')+"</div>").addClass("email-verified");n.append(i),e.phoneNumber&&($phoneNumber=$("<p></p>"),$phoneNumber.text("Phone Number: "+e.phoneNumber),n.append($phoneNumber)),n.append('<div class="clearfix" />'),n.append('<div class="clearfix" />')}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};validator.equals=function(e,t){return e===t},validator.isNumber=function(e){return"number"==typeof e},validator.isString=function(e){return"string"==typeof e},validator.exists=function(e){return void 0!==e&&null!==e},App.connection={firebase:!1},firebase.database().ref(".info/connected").on("value",function(e){!0===e.val()?App.connection.firebase=!0:App.connection.firebase=!1}),$(document).ready(function(){function e(){firebase.auth().signOut().then(function(){console.log("Sign-out successful")}).catch(function(e){console.log("An error happened.")})}function t(){var e=new firebase.auth.GoogleAuthProvider;e.setCustomParameters({redirect_uri:"profile",login_hint:"user@example.com"}),firebase.auth().signInWithRedirect(e)}function n(){var e=new firebase.auth.TwitterAuthProvider;firebase.auth().signInWithRedirect(e)}function o(){var e=new firebase.auth.FacebookAuthProvider;e.setCustomParameters({display:"popup"}),firebase.auth().signInWithRedirect(e)}function a(){var e=new firebase.auth.GithubAuthProvider;firebase.auth().signInWithRedirect(e)}$(document).on("submit","form.create.emailandpassword",function(e){$(e.target);e.preventDefault(),e.stopPropagation();var t=e.target.elements.email.value,n=e.target.elements.password.value;firebase.auth().createUserWithEmailAndPassword(t,n).then(function(e){console.log("succesfull account createion"),setConditional("loggedin",!0)}).catch(function(e){var t=e.code,n=e.message;console.error(t,n)})}),$(document).on("submit","form.signin.emailandpassword",function(e){$(e.target);e.preventDefault(),e.stopPropagation();var t=e.target.elements.email.value,n=e.target.elements.password.value;firebase.auth().signInWithEmailAndPassword(t,n).then(function(e){console.log("succesfull sigin"),setConditional("loggedin",!0)}).catch(function(e){var t=e.code,n=e.message;console.error(t,n)})}),$(document).on("click",".authlogout",function(t){e()}),$(document).on("click",".signup-providers .signup-with-google",function(e){t()}),$(document).on("click",".signup-providers .signup-with-facebook",function(e){o()}),$(document).on("click",".signup-providers .signup-with-twitter",function(e){n()}),$(document).on("click",".signup-providers .signup-with-github",function(e){a()})}),firebase.auth().onAuthStateChanged(function(e){if(e){var t=firebase.database().ref("users/"+e.uid);setTimeout(function(){t.once("value").then(function(n){!1===n.exists()&&(console.log("adding user to the user list"),t.set({public:{displayName:e.displayName,uid:e.uid},email:e.email,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,phoneNumber:e.phoneNumber,photoURL:e.photoURL,providerData:e.providerData,providerId:e.providerId}))})},0)}}),firebase.auth().onAuthStateChanged(function(e){console.log("onAuthStateChanged",e),setConditional("loggedin",e)}),$(document).ready(function(){var e=$(".navbar-sticky-top");if(0!==e.length){var t=$(".sticky-navbar-container");e.addClass("navbar-static-top");var n=e.offset().top;$(window).on("scroll",function(o){var a=$(window).scrollTop();n<=a?(e.removeClass("navbar-static-top"),e.addClass("navbar-fixed-top"),t.addClass("inflate")):(e.addClass("navbar-static-top"),e.removeClass("navbar-fixed-top"),t.removeClass("inflate"))})}}),function(){function e(e){return console.log(e),['<li class="forumpostlist-item list-group-item">','<a href="post?key='+encodeURIComponent(e._key)+'">',"<h1>"+escapeHtml(e.title)+"</h1>","</a>",'<div class="forumpostlist-itemcontent">',sanitizeHtml(e.content),"</div>","</li>"].join("")}function t(e){switch(e){case"popular":return function(e,t){return t.views-e.views};case"recent":return function(e,t){return t.timestamp-t.timestamp};case"rated":return function(e,t){return t.rating-e.rating};case"alphabetical":return function(e,t){return e.title.charCodeAt(0)-t.title.charCodeAt(0)};default:return t("popular")}}0!==$(".forumpostscomponent").length&&firebase.database().ref("posts").once("value").then(function(n){var o=propToArr(n.val());$(".forumpostscomponent").each(function(n,a){var r=$(a);r.removeClass("ready"),r.attr("data-props")||console.error("data-props attribute not defined on: ",r.get(0));var i=JSON.parse(r.attr("data-props").replace(/'/gm,'"'));console.log(o,i);var s=$(a).children(".posts");o.slice(0).sort(t(i.sortBy));o.slice(0,i.amount||12).forEach(function(t){s.append(e(t))}),r.addClass("ready")})})}(),function(){function e(e,t){$(e).find(".post-content").html(sanitizeHtml(t.content)),$(e).find(".post-title").text(t.title),$(e).find(".post-time").text(new Date(t.timestamp).toLocaleString()),$(e).find(".post-user").text(t.user)}function t(e,t){(t||[]).forEach(function(t){n(e,t)})}function n(e,t){$(e).find(".post-comments").prepend(function(e){return['<li class="comment">','<div class="panel panel-default">','<div class="panel-body">','<span class="comment-content">',sanitizeHtml(e),"</span>","</div>","</div>","</li>"].join("")}(t.content))}function o(e,t,o){var a=$(t).html(),r=$(t).text(),i=firebase.auth().currentUser;if(!0===checkValid(validator(!0===App.connection.firebase,"Sorry, we could not establish a connection to the server. We are not able to process your request"),validator(null!==i,"Sorry, we were not able to verify that you are currently logged in. Please login if your not already."))){var s={content:sanitizeHtml(a),userId:i.uid,timestamp:firebase.database.ServerValue.TIMESTAMP},l=checkValid(validator(validator.exists(s.content),"A comment requires content"),validator(validator.exists(s.userId),"A comment requires a user id"),validator(validator.exists(s.timestamp),"A comment requires a timestamp"),validator(r.length<=400,"A commment cannot have more than 400 characters"),validator(r.length>=5,"A comment content requiers at least 5 characters"),validator(s.content.length<=2e3,"A comment content contains more than 2000 html entities"));if(!0===l){console.log("submitting comment:",s);var c=firebase.database().ref("posts/"+e+"/comments").push(s);$(o).button("loading"),console.log(o),c.catch(function(e){setTimeout(function(){$(o).button("reset")},200),console.error(e)}).then(function(e){setTimeout(function(){$(o).button("reset")},200),console.log("done")});var u=c.key;console.log("comment key:",u),n($(".forumpost").get(0),s)}else console.error(l)}else console.error(l)}if(0!==$(".forumpost").length){var a=getParameterByName("key",window.location.href);firebase.database().ref("posts/"+a).once("value").then(function(n){var r=n.val(),i=$(".forumpost");firebase.database().ref("posts/"+a+"/comments");$(document).on("submit",".commentcreate",function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target).closest(".forumpost"),n=$(e.target).find("[type=submit]");t.find(".post-comments");o(a,$(l.container).find(".ql-editor"),n.get(0))}),e(i.get(0),r);var s=propToArr(r.comments);t(i.get(0),s||[]);var l=new Quill("#editor",{modules:{toolbar:"#toolbar"},theme:"snow",placeholder:"Write a comment"});i.on("keyup",".ql-editor",function(e){var t=$(e.target).text().length||0;i.find(".currchars").text(t),t>400?(i.find(".remaining").addClass("text-danger"),i.find(".remaining").removeClass("text-muted")):(i.find(".remaining").removeClass("text-danger"),i.find(".remaining").addClass("text-muted"))}),i.addClass("ready")})}}(),function(){if($(document).ready(function(){function t(e,t){var n=checkValid(validator(!0===App.connection.firebase,"Sorry, we could not establish a connection to the server. We are not able to process your request"));if(!0!==n)return{result:!1,err:n};var o=firebase.auth().currentUser,a={title:e,content:sanitizeHtml(t),timestamp:firebase.database.ServerValue.TIMESTAMP,userId:o.uid},r=checkValid(validator(null!==o,"Sorry, we were not able to verify that you are currently logged in. Please login if your not already."),validator(validator.exists(a.title),"A post requires a title"),validator(validator.exists(a.content),"A post requires content"),validator(validator.exists(a.userId),"A post requires a user id"),validator(validator.exists(a.timestamp),"A post requires a timestamp"),validator(a.title.length<=1e3,"A post's title cannot have more than 1000 html entities"),validator(a.content.length<=2e4,"A posts's content cannot have more than 20000 html entities"));if(!0!==r)return{result:!1,err:r};var i=firebase.database().ref("posts").push(a),s=i.key;return console.log("newpost key",s),{result:!0,promise:i}}$(document).on("submit","form.newforumpost",function(n){n.preventDefault(),n.stopPropagation();var o=$(n.target),a=t(o.get(0).elements.title.value,$(e.container).find(".ql-editor").html());if(!1!==a.result){try{o.find("[type=submit]").button("loading"),$("#forumpostsubmitteddialog").css("top","-100vh").modal("show").animate({top:"0"},"slow")}catch(e){}a.promise.catch(function(e){$("#forumpostsubmitteddialog").modal("hide"),o.find("[type=submit]").button("reset")}).then(function(e){setTimeout(function(){window.location.replace("post?key="+encodeURIComponent(e.key))},0)})}else console.error(a.err)})}),$("form.newforumpost").length>0){var e=new Quill("#editor",{modules:{toolbar:"#toolbar"},theme:"snow",placeholder:"New post"}),t=$(".newforumpost");t.on("keyup",".ql-editor",function(e){var n=$(e.target).text().length||0;t.find(".currchars").text(n),n>1e3?(t.find(".remaining").addClass("text-danger"),t.find(".remaining").removeClass("text-muted")):(t.find(".remaining").removeClass("text-danger"),t.find(".remaining").addClass("text-muted"))})}}(),firebase.auth().onAuthStateChanged(function(e){e&&onAuthStateLogin(e)}),firebase.auth().onAuthStateChanged(function(e){console.log("onAuthStateChanged",e),setConditional("ready",!0)});